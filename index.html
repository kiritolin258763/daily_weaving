<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ‰¾é›¶é¡¯ç¤º</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body, html { height: 100%; }
  </style>
</head>
<body class="bg-black flex items-center justify-center">
  <div id="display" class="text-white text-center">
    <p class="text-3xl">ç­‰å¾…ä¸­...</p>
  </div>

  <script>
    const SHEET_URL = "https://script.google.com/macros/s/AKfycbyPwtz3iQnuW-AgevyncjI8Tpzn-py_tvk-K4l-ctHx9KyRge4r0ezTO6mHbG3brUbPfA/exec";
    const display = document.getElementById('display');
Â  Â  let lastTxn = "";
Â  Â  let timeoutID = null; // ğŸŒŸ æ–°å¢ï¼šç”¨æ–¼å„²å­˜ç•¶å‰è¨ˆæ™‚å™¨ ID

Â  Â  async function fetchLatest() {
Â  Â  Â  try {
Â  Â  Â  Â  const res = await fetch(SHEET_URL);
Â  Â  Â  Â  const data = await res.json();

Â  Â  Â  Â  if (data.txnId && data.txnId !== lastTxn) {
Â  Â  Â  Â  Â  lastTxn = data.txnId;
Â  Â  Â  Â  Â  showTransaction(data); 
Â  Â  Â  Â  }
Â  Â  Â  } catch (err) {
Â  Â  Â  Â  console.log("è®€å–éŒ¯èª¤", err);
Â  Â  Â  }
Â  Â  }

    function showTransaction(data) {
        // ğŸŒŸ é—œéµä¿®æ­£ 1ï¼šç•¶é¡¯ç¤ºæ–°äº¤æ˜“æ™‚ï¼Œæ¸…é™¤ä¸Šä¸€å€‹è¨ˆæ™‚å™¨
        if (timeoutID) {
            clearTimeout(timeoutID);
            timeoutID = null;
        }

        const total = data.total;
        const payment = data.payment;
        const change = data.change;
        let content = '';

        if (data.status === 'No Data') {
             content = `<p class="text-3xl">ç­‰å¾…ä¸­...</p>`;
             // ä¸éœ€è¦å•Ÿå‹• timeoutIDï¼Œå› ç‚ºæˆ‘å€‘å¸Œæœ›å®ƒä¿æŒé¡¯ç¤º
        } else if (payment === 'Cash' && change > 0) {
            // æƒ…æ³ä¸€ï¼šéœ€æ‰¾é›¶çš„ç¾é‡‘äº¤æ˜“
            content = `
              <p class="text-3xl font-bold mb-4">äº¤æ˜“ç¸½é¡ï¼š<span class="text-green-400">${total}</span> å…ƒ</p>
              <p class="text-4xl font-bold mb-4">ğŸ’° æ‡‰æ‰¾é›¶é‡‘é¡</p>
              <p class="text-7xl font-extrabold text-yellow-400">${change}</p>
              <p class="text-2xl mt-4">å…ƒ</p>
            `;
            // ğŸŒŸ é—œéµä¿®æ­£ 2ï¼šé‡æ–°å•Ÿå‹•è¨ˆæ™‚å™¨ä¸¦å„²å­˜ ID
            timeoutID = setTimeout(showCard, 6000); 
        } else if (payment === 'Cash' && change === 0) {
            // æƒ…æ³äºŒï¼šä¸éœ€æ‰¾é›¶çš„ç¾é‡‘äº¤æ˜“
            content = `
              <p class="text-4xl font-bold mb-4">äº¤æ˜“ç¸½é¡ï¼š<span class="text-green-400">${total}</span> å…ƒ</p>
              <p class="text-7xl font-extrabold text-white">è¬è¬ï¼</p>
              <p class="text-2xl mt-4">ä¸éœ€æ‰¾é›¶</p>
            `;
            // ğŸŒŸ é—œéµä¿®æ­£ 2ï¼šé‡æ–°å•Ÿå‹•è¨ˆæ™‚å™¨ä¸¦å„²å­˜ ID
            timeoutID = setTimeout(showCard, 6000); 
        } else {
            // æƒ…æ³ä¸‰ï¼šéç¾é‡‘äº¤æ˜“ (LINE Pay)
            content = `
              <p class="text-4xl font-bold mb-4">äº¤æ˜“ç¸½é¡ (${payment})</p>
              <p class="text-7xl font-extrabold text-blue-400">${total}</p>
              <p class="text-3xl mt-8">è«‹æƒæä»˜æ¬¾ç¢¼</p>
            `;
            // ğŸŒŸ é—œéµä¿®æ­£ 2ï¼šé‡æ–°å•Ÿå‹•è¨ˆæ™‚å™¨ä¸¦å„²å­˜ ID
            timeoutID = setTimeout(showCard, 6000); 
        }
        
        display.innerHTML = content;
    }

Â  Â  function showCard() {
Â  Â  Â  display.innerHTML = `
Â  Â  Â  Â  <p class="text-3xl">æ­¡è¿å…‰è‡¨</p>
Â  Â  Â  `;
      timeoutID = null;
Â  Â  }

Â  Â  // åˆå§‹åŒ–é¡¯ç¤ºä¸€å€‹éœæ…‹æ­¡è¿è¨Šæ¯
    showCard(); 

Â  Â  // æ¯2ç§’æª¢æŸ¥ä¸€æ¬¡æ˜¯å¦æœ‰æ–°äº¤æ˜“
Â  Â  setInterval(fetchLatest, 2000);
  </script>
</body>
</html>

